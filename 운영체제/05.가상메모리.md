사용자가 프로그램을 실행하면 OS는 디스크에 저장된 데이터를 메모리로 로드한다.  
하지만 메모리 공간은 한정되어 있고, 사용자는 동시에 많은 프로그램을 실행하고 싶어한다.  
이런 메모리 공간의 한계를 극복하기 위해 가상 메모리라는 개념이 등장했다.  

# 1. 가상 메모리란
프로세스의 일부만 메모리에 로드하고, 나머지는 디스크에 둔 상태로 프로세스를 실행하는 방식이다.  
사용자에게는 프로세스 전체가 메모리에 로드된 것처럼 보이지만, 실제로는 전체가 로드된 것이 아니어서 가상 메모리라고 한다.

## 1.1 가상메모리 장점
- 프로그램이 메모리 크기에 대한 제약을 덜 받을 수 있다.
- 동시에 많은 프로그램을 실행하므로 CPU 이용률과 처리율을 높일 수 있다.
- 필요한 영역만 메모리에 로드해 스와핑 횟수를 줄여 프로그램 실행 속도를 높일 수 있다.

# 2. 요구 페이징
프로세스에서 필요한 페이지만 메모리에 로드하는 방식이다.  
페이지를 모두 메모리에 로드하지 않고 초기에 필요한 영역만 로드한 후 다른 영역은 요청이 올 때 메모리에 로드한다.  

## 2.1 페이지 폴트
프로그램을 실행하다가 물리 메모리에 필요한 페이지가 없을 때를 말한다.  
페이지 폴트가 발생하면 운영체제에서 처리를 담당하며, 페이지 폴트 핸들러가 그 처리 메커니즘을 규정한다.  

**페이지 폴트가 발생하면 디스크에서 필요한 페이지를 `스왑 인`한다.**   
(스왑인: 필요할 때 저장 장치에서 메모리로 다시 프로세스를 옮겨와 실행한다.)

- 이때 페이지에 해당하는 메모리 영역이 물리 메모리에 있는지는 페이지 테이블로 파악할 수 있다.
- 페이지 테이블은 페이지에 해당하는 프레임이 존재하면 v(valid) 값을 반환한다.
- 프레임이 존재하지 않거나 유효하지 않은 주소 값이면 i(invalid) 값을 반환한다. 

## 2.2 페이지 폴트 발생 시 처리 과정
<img width="500" alt="페이지폴트처리과정" src="https://github.com/user-attachments/assets/132099b7-c80e-4e9e-9b91-a100cd21ab20">

# 3. 스레싱(thrashing)
잦은 페이지 부재로 하드디스크 입출력이 너무 많아져 작업이 멈춘 것 같은 상태이다.
<img width="500" alt="스레싱" src="https://github.com/user-attachments/assets/880572d6-65ba-41bb-8925-6be6603d4875">

동시에 일정 수 이상의 프로그램을 실행했을 때 오히려 CPU 이용률이 떨어지는 상황을 말한다.  
가상 메모리를 구현해 다중 프로그래밍을 하면 CPU 이용률이 높아진다.  
하지만 일정 수 이상으로 다중 프로그래밍을 하면 페이지 폴트가 자주 일어난다. 

따라서 디스크 영역에서 필요한 페이지를 스왑인하고 불필요한 페이지를 스왑아웃하는 작업도 자주하게 된다.  
다중 프로그래밍 정도 일정 수준 이상 높아지면 페이징이 빈번히 일어나게 되고 실질적으로 CPU 이용률이 떨어지는 스레싱이 발생한다.  

## 3.1 스레싱 발생 시점
- CPU가 작업하는 시간보다 스왑 영역으로 페이지를 보내고 새로운 페이지를 메모리에 가져오는 작업이 빈번해져서 CPU가 작업할 수 없는 상태에 이르게 되는 시점
- 물리 메모리의 크기를 늘리면 스레싱 발생 시점이 늦춰져서 프로세스를 원만하게 실행할 수 있다.  

## 3.2 워킹 세트
스레싱을 예방하려면 워킹 세트를 설정하는 방법이 있다.   
워킹 세트는 `지역성`을 기반으로 `자주 사용하는 페이지를 저장`해 두는 것을 의미한다.  
워킹 세트를 바탕으로 자주 사용하는 페이지를 물리 메모리의 프레임에 고정하면 페이지 폴트가 빈번하게 발생하는 현상을 방지할 수 있다.  

## 참고
[[페이지 폴트]2-14장. 물리 메모리 크기의 극복 : 메커니즘](https://lipcoder.tistory.com/102)  
[[스레싱] 운영체제-스레싱](https://yansigit.github.io/blog/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%EC%8A%A4%EB%A0%88%EC%8B%B1/)